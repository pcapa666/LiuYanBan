"use strict";const e=require("../../common/vendor.js"),t={data:()=>({userid:"",activeTab:!0,CurrentTime:"",userInfo:{},list:[],onlist:[]}),computed:{getOnGood:()=>function(e){return-1!==e.good.userid.indexOf(this.userid)},getOnCollect:()=>function(e){return-1!==e.shouChang.indexOf(this.userid)},getCommentNum:()=>function(e){return e.commentList.length},getMessageTime:()=>function(e){const t=new Date(this.CurrentTime),n=new Date(e);let i=t.getFullYear(),o=n.getFullYear(),s=("0"+(n.getMonth()+1)).slice(-2),r=("0"+n.getDate()).slice(-2);if(n.getHours()<10?n.getHours():("0"+n.getHours()).slice(-2),n.getMinutes()<10?n.getMinutes():("0"+n.getMinutes()).slice(-2),i==o){if(("0"+(t.getMonth()+1)).slice(-2)==s){let e=("0"+t.getDate()).slice(-2);if(e==r){const e=t.getTime()-n.getTime(),i=Math.floor(e/6e4),o=Math.floor(i/60);return o>0?`${o}小时前`:i>0?`${i}分钟前`:"刚刚"}if(e-r==1)return"昨天";if(e-r==2)return"前天";if(e-r>=3&&e-r<=7){return e-r+"天前"}return"本月"}return s+"月"+r+"日"}return o+"年"+s+"月"+r+"日"}},methods:{onCollect(t,n){e.index.showLoading({title:"收藏..."}),e.Ds.callFunction({name:"fun",data:{api:"onCollect",token:e.index.getStorageSync("token"),_id:t._id}}).then((e=>{this.goList()})).catch((()=>{e.index.hideLoading(),e.index.showToast({title:"失败",icon:"error"})}))},onGood(t,n){e.index.showLoading({title:"点赞中..."}),e.Ds.callFunction({name:"fun",data:{api:"onGood",token:e.index.getStorageSync("token"),_id:t._id}}).then((e=>{this.goList()})).catch((()=>{e.index.hideLoading(),e.index.showToast({title:"失败",icon:"error"})}))},unlist(){this.activeTab=!this.activeTab,this.activeTab?this.onlist=this.list.slice().reverse():this.onlist=this.list},onDelete(t){const n=this;e.index.showModal({title:"确认删除",content:"您确定要删除这条记录吗？",success:function(i){i.confirm?(console.log("用户点击了确认按钮"),e.Ds.callFunction({name:"fun",data:{api:"deleteMessage",token:e.index.getStorageSync("token"),_id:t}}).then((()=>{n.goList(),e.index.showToast({title:"删除成功",icon:"success"})})).catch((t=>{e.index.showToast({title:"删除失败",icon:"error"})}))):i.cancel&&console.log("用户点击了取消按钮")}})},toMessage(t){e.index.navigateTo({url:`../message/message?message=${JSON.stringify(t)}`})},getCurrentTime(){const e=(new Date).getTime();this.CurrentTime=e},goList(t){console.log("调用了 goList() 函数！"),e.Ds.callFunction({name:"fun",data:{api:"getMyMassage",token:e.index.getStorageSync("token")}}).then((t=>{e.index.hideLoading(),this.list=t.result.message.data,this.onlist=t.result.message.data.slice().reverse(),this.userid=t.result.userId})).catch((()=>{e.index.hideLoading(),e.index.showToast({title:"获取数据失败",icon:"error"})}))}},onShow(){e.index.showLoading({title:"加载中..."}),this.getCurrentTime(),this.goList()}};const n=e._export_sfc(t,[["render",function(t,n,i,o,s,r){return e.e({a:e.f(s.onlist,((t,n,i)=>({a:t.userInfo.avatarUrl,b:e.t(t.userInfo.nickName),c:1==t.userInfo.sexIndex,d:2==t.userInfo.sexIndex,e:3==t.userInfo.sexIndex,f:e.o((e=>r.onDelete(t._id)),t._id),g:e.t(t.content),h:e.t(r.getMessageTime(t.CurrentTime)),i:e.o((e=>r.onCollect(t,e)),t._id),j:r.getOnCollect(t),k:e.o((e=>r.onCollect(t,e)),t._id),l:!r.getOnCollect(t),m:e.t(t.good.num),n:e.o((e=>r.onGood(t,e)),t._id),o:r.getOnGood(t),p:e.t(t.good.num),q:e.o((e=>r.onGood(t,e)),t._id),r:!r.getOnGood(t),s:e.t(r.getCommentNum(t)),t:e.o((e=>r.toMessage(t)),t._id),v:t._id}))),b:!this.onlist.length},(this.onlist.length,{}),{c:e.o(((...e)=>r.unlist&&r.unlist(...e)))})}]]);wx.createPage(n);
